{{
extend 'layout.html'
}}

<meta name="description" content="Solver for the randomized Super Metroid roms"/>
<link rel="shortcut icon" href={{=URL('static','favicon.ico')}} type="image/ico"/>
<script src="{{=URL('static','js/FileSaver.js')}}"></script>
<link rel="stylesheet" type="text/css" href={{=URL('static','css/mystyle.css')}} media="screen"/>

<link rel="stylesheet" type="text/css" href={{=URL('static','dist/switchery.css')}} media="screen"/>
<script src="{{=URL('static','dist/switchery.js')}}"></script>

<link href={{=URL('static', 'css/bootstrap-tour.min.css')}} rel="stylesheet">
<script src="{{=URL('static','js/bootstrap-tour.min.js')}}"></script>

<title>Super Metroid VARIA Randomizer</title>

<style>
@media (min-width: 1200px) {
    .main {
        margin-top: 2em; /* Add a top margin to avoid content overlay */
    }
}
.main {
    margin-bottom: 5em;
}
.main-container {
    margin-top: 0px;
}
body {
    margin-bottom: 0px;
}
#overlay {
    position: fixed; /* Sit on top of the page content */
    display: none; /* Hidden by default */
    width: 100%; /* Full width (cover the whole page) */
    height: 100%; /* Full height (cover the whole page) */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0,0,0,0.5); /* Black background with opacity */
    z-index: 2; /* Specify a stack order in case you're using a different order for other elements */
    cursor: pointer; /* Add a pointer on hover */
}
#loadingGIF {
    position: absolute;
    left: 5%;
    z-index: 3;
    display:none;
}
@media (max-height: 800px) {
    .loadingGIF {
         top: 20%;
    }
}
@media (min-height: 800px) {
    .loadingGIF {
         top: 40%;
    }
}
.hidden {
    display: none;
}
</style>

<script type="text/javascript">
function AjaxPresetCallCompleted(data) {
    console.log("AjaxPresetCallCompleted");

    // call web service with parameters
    var request = $.ajax({
      //url: "http://ouicherandomizer.pythonanywhere.com/randomizer/solver_web/randomizerWebService",
      url: "{{=URL(f='randomizerWebService')}}",
      method: "POST",
      data: {
        seed : document.getElementById("seed").value,
        paramsFile : document.getElementById("paramsFile").value,
        paramsFileTarget : data,
        missileQty : document.getElementById("missileQty").value,
        superQty : document.getElementById("superQty").value,
        powerBombQty : document.getElementById("powerBombQty").value,
        minorQty : document.getElementById("minorQty").value,
        energyQty : document.getElementById("energyQty").value,
        useMaxDiff : document.getElementById("useMaxDiff").value,
        maxDifficulty : document.getElementById("maxDifficulty").value,
        progressionSpeed : document.getElementById("progressionSpeed").value,
        spreadItems : document.getElementById("spreadItems").value,
        fullRandomization : document.getElementById("fullRandomization").value,
        suitsRestriction : document.getElementById("suitsRestriction").value,
        speedScrewRestriction : document.getElementById("speedScrewRestriction").value,
        AimAnyButton : document.getElementById("AimAnyButton").value,
        itemsounds : document.getElementById("itemsounds").value,
        spinjumprestart : document.getElementById("spinjumprestart").value,
        supermetroid_msu1 : document.getElementById("supermetroid_msu1").value,
        max_ammo_display : document.getElementById("max_ammo_display").value,
        elevators_doors_speed : document.getElementById("elevators_doors_speed").value,
        skip_ceres : document.getElementById("skip_ceres").value,
        skip_intro : document.getElementById("skip_intro").value,
        animals : document.getElementById("animals").value,
        funCombat : document.getElementById("funCombat").value,
        funMovement : document.getElementById("funMovement").value,
        funSuits : document.getElementById("funSuits").value,
layoutPatches : document.getElementById("layoutPatches").value,
        Removes_Gravity_Suit_heat_protection : document.getElementById("Removes_Gravity_Suit_heat_protection").value
      },
      dataType: "json",
      crossDomain: true
    });

    request.done(AjaxRandomizerCallCompleted);
    request.fail(ajaxFailJSON);
}

function ajaxFail(jqXHR, textStatus) {
  document.getElementById("flash").innerHTML = jqXHR.responseText;
  $('#flash').show();
  $('#overlay').hide();
  $('#loadingGIF').hide();
}

function ajaxFailJSON(jqXHR, textStatus) {
  // cross domain calls currently return 'undefined' information... (cf. https://www.html5rocks.com/en/tutorials/cors/)
  if(jqXHR.responseJSON == null) {
    document.getElementById("flash").innerHTML = "Something wrong happened or the VARIA randomizer aborted: try again or try to raise or disable max difficulty setting, or disable Super Fun Times (TM) setting";
  } else {
    document.getElementById("flash").innerHTML = jqXHR.responseJSON;
  }
  $('#flash').show();
  $('#overlay').hide();
  $('#loadingGIF').hide();
}

function AjaxRandomizerCallCompleted(data) {
    console.log("AjaxRandomizerCallCompleted");

    // with items/Locations patch the local rom in memory
    var filesInput = document.getElementById("uploadFile");
    var file = filesInput.files[0]

    var reader = new FileReader();
    reader.readAsArrayBuffer(file)

    reader.onload = function(e) {
        var bytes = new Uint8Array(e.target.result);

        for(var key in data) {
            if(key === "fileName") { continue; }
            bytes[key] = data[key];
        }

        var blob = new Blob([bytes], {type: "octet/stream"})

        var outFileName = data['fileName']
        saveAs(blob, outFileName)
    }

    // set backup button text to Randomize
    document.getElementById("submitBtn").data = "Randomize";
    console.log("button text set back to randomize");

    // call webservice to update the session
    var request = $.ajax({
      url: "{{=URL(f='sessionWebService')}}",
      method: "POST",
      data: {
        paramsFile : document.getElementById("paramsFile").value,
        missileQty : document.getElementById("missileQty").value,
        superQty : document.getElementById("superQty").value,
        powerBombQty : document.getElementById("powerBombQty").value,
        minorQty : document.getElementById("minorQty").value,
        energyQty : document.getElementById("energyQty").value,
        useMaxDiff : document.getElementById("useMaxDiff").value,
        maxDifficulty : document.getElementById("maxDifficulty").value,
        progressionSpeed : document.getElementById("progressionSpeed").value,
        spreadItems : document.getElementById("spreadItems").value,
        fullRandomization : document.getElementById("fullRandomization").value,
        suitsRestriction : document.getElementById("suitsRestriction").value,
        speedScrewRestriction : document.getElementById("speedScrewRestriction").value,
        AimAnyButton : document.getElementById("AimAnyButton").value,
        itemsounds : document.getElementById("itemsounds").value,
        spinjumprestart : document.getElementById("spinjumprestart").value,
        supermetroid_msu1 : document.getElementById("supermetroid_msu1").value,
        max_ammo_display : document.getElementById("max_ammo_display").value,
        animals : document.getElementById("animals").value,
        elevators_doors_speed : document.getElementById("elevators_doors_speed").value,
        skip_ceres : document.getElementById("skip_ceres").value,
        skip_intro : document.getElementById("skip_intro").value,
        funCombat : document.getElementById("funCombat").value,
        funMovement : document.getElementById("funMovement").value,
        funSuits : document.getElementById("funSuits").value,
        layoutPatches : document.getElementById("layoutPatches").value,
        Removes_Gravity_Suit_heat_protection : document.getElementById("Removes_Gravity_Suit_heat_protection").value
      },
      dataType: "html"
    });

    request.fail(ajaxFail);

    // remove "working" message
    $('#flash').hide();
    $('#overlay').hide();
    $('#loadingGIF').hide();
}

function doSubmit() {
  if(window.File && window.FileList && window.FileReader) {

    var filesInput = document.getElementById("uploadFile");
    var file = filesInput.files[0]
    if (file === undefined) {
      alert("Please select a Super Metroid Vanilla ROM first")
      btn = document.getElementById("submitBtn");
      btn.data = "Randomize";
      btn.disabled = false;

      setTimeout(function(){ 
          btn = document.getElementById("submitBtn");
          btn.data = "Randomize";
          btn.disabled = false;
      }, 20000);

      return false;
    }

    console.log("before preset web service call");

    // call preset web service with parameters
    var request = $.ajax({
      url: "{{=URL(f='presetWebService')}}",
      method: "POST",
      data: { paramsFile : document.getElementById("paramsFile").value },
      dataType: "html"
    });

    request.done(AjaxPresetCallCompleted);
    request.fail(ajaxFail);

    // while WS is working, display "working" message
    $('#overlay').show();
    $('#loadingGIF').show();
  }

  return false;
}

window.onload = function(){
    //Check File API support
    if(window.File && window.FileList && window.FileReader) {
        var filesInput = document.getElementById("uploadFile");
        filesInput.addEventListener("change", function(event){
            var files = event.target.files; //It returns a FileList object
            var file = files[0];

            var reader = new FileReader();
            reader.onload = function(e) {
		// check sfc or smc extention
                var re = /(?:\.([^.]+))?$/;
		var ext = re.exec(file.name)[1];
                console.log("ext: "+ext)
                if( ! (ext === "sfc" || ext === "smc") ) {
                    document.getElementById("uploadFile").value = "";
                    alert("wrong extension: "+ext);
                    return false;
                }

                var fileSize = file.size;
		if( fileSize > 4*1024*1024 ) {
                    document.getElementById("uploadFile").value = "";
                    alert("wrong rom file size: "+fileSize.toString());
                    return false;
                }
            }

            reader.readAsArrayBuffer(file)

        }, false);
    } else {
        alert("This website requires the HTML5 File API, please upgrade your browser to a newer version.");
    }

    var skipCeres = document.getElementById("skip_ceres");
    skipCeres.onchange = function(){
        var skipCeres = document.getElementById("skip_ceres");
        var skipIntro = document.getElementById("skip_intro");

        // if both are set, unselect the other one
        if(skipCeres.checked && skipIntro.checked){
            skipIntro.click();
        }
        // if none are set, select the other one
        if(! skipCeres.checked && ! skipIntro.checked){
            skipIntro.click();
        }

        switchCheckbox("skip_ceres");
    };

    var skipIntro = document.getElementById("skip_intro");
    skipIntro.onchange = function(){
        var skipCeres = document.getElementById("skip_ceres");
        var skipIntro = document.getElementById("skip_intro");

        if(skipIntro.checked && skipCeres.checked){
            skipCeres.click();
        }
        if(! skipCeres.checked && ! skipIntro.checked){
            skipCeres.click();
        }
        switchCheckbox("skip_intro");
    };

    // if none are set, activate skip ceres
    if(! skipCeres.checked && ! skipIntro.checked){
        skipCeres.click();
    }

    var maxAmmo = document.getElementById("max_ammo_display");
    maxAmmo.onchange = function(){
        var maxAmmo = document.getElementById("max_ammo_display");
        var msu1 = document.getElementById("supermetroid_msu1");

        if(msu1.checked && maxAmmo.checked){
            msu1.click();
        }
        switchCheckbox("max_ammo_display");
    };

    var msu1 = document.getElementById("supermetroid_msu1");
    msu1.onchange = function(){
        var maxAmmo = document.getElementById("max_ammo_display");
        var msu1 = document.getElementById("supermetroid_msu1");

        if(maxAmmo.checked && msu1.checked){
            maxAmmo.click();
        }
        switchCheckbox("supermetroid_msu1");
    };

    var useMax = document.getElementById("useMaxDiff");
    if(! useMax.checked){
        document.getElementById("maxDifficulty").disabled = true;
    }
    useMax.onchange = function(){
        var useMax = document.getElementById("useMaxDiff");
        if(useMax.checked){
            document.getElementById("maxDifficulty").disabled = false;
        } else {
            document.getElementById("maxDifficulty").disabled = true;
        }
        switchCheckbox("useMaxDiff");
    }

    var progSpeed = document.getElementById("progressionSpeed");
    progSpeed.onchange = function(){
        var progSpeed = document.getElementById("progressionSpeed");
        if(progSpeed.value == 'slow' || progSpeed.value == 'slowest'){
            var suitsRestriction = document.getElementById("suitsRestriction");
            var spreadItems = document.getElementById("spreadItems");

            if(! suitsRestriction.checked){
                suitsRestriction.click();
            }
            if(! spreadItems.checked){
                spreadItems.click();
            }
        }
        if(progSpeed.value == 'fast' || progSpeed.value == 'fastest'){
            var spreadItems = document.getElementById("spreadItems");

            if(spreadItems.checked){
                spreadItems.click();
            }
        }
        if(progSpeed.value == 'fastest'){
            var suitsRestriction = document.getElementById("suitsRestriction");

            if(suitsRestriction.checked){
                suitsRestriction.click();
            }
        }
    }
}
function switchCheckbox(id) {
  var check = document.getElementById(id);
  if(check.checked){
    check.value = "on";
  } else {
    check.value = "off";
  }
}

function startTheTour(step=-1) {
  // the tour tutorial
  var tour = new Tour({
    storage: false,
    steps: [
    {
      element: "#uploadFile",
      title: "Vanilla Super Metroid ROM",
      content: "Use an American/Japan unheadered ROM of Super Metroid.<br/>The randomized ROM is generated locally."
    },
    {
      element: "#seed",
      title: "Randomizer seed",
      content: "Choose a seed number between 1 and 9999999, choose 0 to generate a random one."
    },
    {
      element: "#paramsFile",
      title: "Preset used to randomize",
      content: "The preset is used by the Randomizer to know which techniques are available to reach the items locations.</br>You can create and manage your preset on the <a href=\"/solver/solver_web/solver\">Solver part of the website</a>.<br/>You can use one of the predefined ones:<ul><li>noob</li><li>regular</li><li>veteran</li><li>speedrunner</li></ul><br/>However, creating your own preset will lead to a better experience overall, as the generated ROMs will be tailored for you."
    },
    {
      element: "#missileQty",
      title: "Quantity of Missiles/Super Missiles/Power Bombs",
      content: "For each minor types, the higher the number the higher the probability of choosing it when placing a minor."
    },
    {
      element: "#minorQty",
      title: "Percentage of minors available",
      content: "From 1%: minimum number of minors required to finish the game to 100%: all minors locations contain a minor (vanilla like)."
    },
    {
      element: "#energyQty",
      title: "Quantity of Energy/Reserve Tanks available",
      content: "Choose how many Energy/Reserve Tanks will be available, from 5 in sparse, 11 in medium and 18 in vanilla."
    },
    {
      element: "#maxDifficulty",
      title: "Maximum difficulty for picking up an item",
      content: "Depending on the perceived difficulties of the techniques, bosses, hell runs etc. from the preset, it will prevent the Randomizer from placing an item in a location too difficult to reach with the current items.<br/><b>Warning:</b> if too low may cause the randomizer to abort."
    },
    {
      element: "#progressionSpeed",
      title: "Progression speed",
      content: "A progression item is an item opening new locations once picked up : suit, movement item, or any item that opens up locations when placed by the Randomizer.<br/>This parameter influences how fast progression items are likely to be found. From <b>slowest</b>, stuffing your way with as many non-progression items as possible, to <b>fastest</b>, where you will be able to visit Zebes pretty shortly.<br/>If you played the other Item Randomizers out there, an average Dessy seed would be between fast and fastest, and the average Total Tournament seed would be a medium/fast-ish (these are very accurate measurements)."
    },
    {
      element: "#spreadItemsStep",
      title: "Spread progression items",
      content: "A progression item is an item opening new locations once picked up : suit, movement item, or any item that opens up locations when placed by the randomizer.<br/>Activate this option to balance the main areas in which those items are placed."
    },
    {
      element: "#fullRandomizationStep",
      title: "Full randomization",
      content: "By default the minor and major items are shuffled in their respective pool.<br/>Activate this option to have all items fully randomized."
    },
    {
      element: "#suitsRestrictionStep",
      title: "Suits restriction",
      content: "Prevent Gravity or Varia suits to be placed early in the game."
    },
    {
      element: "#speedScrewRestrictionStep",
      title: "Early Morph",
      content: "No SpeedBooster or Screw Attack in the very first rooms, no Screw Attack in Crateria.<br/>As a consequence, Morph Ball will be either at its vanilla position, or at the E-Tank in the ceiling next to it (like Total randomizer).<br/>If disabled, Morph can be found later in the game (like Dessy randomizer)."
    },
    {
      element: "#layoutPatchesStep",
      title: "Layout patches",
      content: "The layout patches from Total Item Randomizer:\
<ul><li>Disable respawning blocks at Dachora Pit</li>\
<li>Make it possible to escape from below early Super bridge without Bombs</li>\
<li>Replace bomb blocks with shot blocks before Hi-Jump</li>\
<li>Replace bomb blocks with shot blocks at Moat</li>\
<li>Raise platform in first heated Norfair room to not require Hi-Jump</li>\
<li>Raise platforms in Red Tower bottom to always be able to get back up</li>\
<li>Replace bomb blocks with shot blocks before Spazer</li></ul>",
      placement: "auto left"
    },
    {
      element: "#patchesStep",
      title: "Optional patches",
      content: "A selection of optional patches to include to enhance the gaming experience.",
      placement: "auto left"
    },
    {
      element: "#funCombatStep",
      title: "Super Fun Combat",
      content: "Will randomly remove some items from the Combat set:<br/><ul><li>Screw Attack</li><li>Spazer</li><li>Wave Beam</li><li>Plasma Beam</li></ul>",
      placement: "auto left"
    },
    {
      element: "#funMovementStep",
      title: "Super Fun Movement",
      content: "Will randomly remove some items from the Movement set:<br/><ul><li>Hi Jump</li><li>Space Jump</li><li>Grappling Beam</li><li>Spring Ball</li><li>Speed Booster</li><li>Bombs</li></ul>",
      placement: "auto left"
    },
    {
      element: "#funSuitsStep",
      title: "Suitless",
      content: "Will randomly remove some Suits.<br/>Will not activate if relevant known techniques are not enabled in the preset : exit Draygon suitless for Gravity, and Lower Norfair hell runs for Varia",
      placement: "auto left"
    }  ]});

  // Initialize the tour
  tour.init();

  // Start the tour
  if(step != -1) {
    tour.goTo(step);
  }
  tour.start();
}
</script>
{{
def displayCheckbox(id, defaultTrue=False):
  if (id in session.randomizer and session.randomizer[id] == 'on') or (id not in session.randomizer and defaultTrue == True):
}}
    {{=INPUT(_id=id, _name=id, _type="checkbox", _checked="checked", _value="on", _class="js-switch", _onchange="switchCheckbox('{}')".format(id))}}
{{
  else:
}}
    {{=INPUT(_id=id, _name=id, _type="checkbox", _value="off", _class="js-switch", _onchange="switchCheckbox('{}')".format(id))}}
    {{pass}}

  {{
  response.write("<script type=\"text/javascript\">new Switchery(document.getElementById(\"{}\")".format(id), escape=False);
  response.write(", { size: 'small', color: '#ddd' });</script>", escape=False)
  pass
  }}

{{
def displaySelect(id, values, default):
  if id in session.randomizer:
    value = session.randomizer[id]
  else:
    value = default
    pass
}}
  {{
   =SELECT(*values,
           **dict(_id=id, _name=id, value=value, _class="full"))
  }}
{{pass}}
{{
def displayNumber(id, min, max, default):
  if id in session.randomizer:
    value = session.randomizer[id]
  else:
    value = default
    pass

  response.write("<input name=\"{}\" id=\"{}\" type=\"number\" value=\"{}\" min=\"{}\" max=\"{}\" class=\"full\" required>".format(id, id, value, min, max), escape=False)
  pass
}}
<body>
  <div id="overlay"></div>
  <div id="loadingGIF"><img src={{=URL('static/images','ajax-loader.gif')}}/></div>

  <div class="fixed">
    <div class="menu">
      <button class="buttonBack" onclick="startTheTour()"><span class="glyphicon glyphicon-play"/></span>Start the tutorial</button>
      {{=A('Super Metroid VARIA Randomizer and Solver', _href=URL(f='randomizer'), _class='menu')}}
      {{=A('Solve!', _href=URL(f='solver'), _class='menu')}}
      {{=A('Randomize!', _href=URL(f='randomizer'), _class='menu')}}
      {{=A('Information & Contact', _href=URL(f='infos'), _class='menu')}}
    </div>
  </div>

  <div class="main">
    <form id="mainform", name="mainform", onsubmit="doSubmit(); return false;">
      <div class="row">
	<div class="column">
	  <p>The Very Adaptive Randomizer of Items for Anyone (VARIA) randomizer will generate a Super Metroid ROM finishable using the known techniques of the chosen preset</p>
          <table class="full">
            <colgroup><col class="half" /><col class="half" /></colgroup>
            <tr>
              <td>Vanilla Super Metroid ROM:</td>
              <td>{{=INPUT(_type="file", _name="uploadFile", _id="uploadFile", _class="full")}}</td>
              <td><button type="button" onclick="startTheTour(0)">?</button></td>
            </tr>
            <tr>
              <td>Randomizer seed:</td>
              <td>{{displayNumber("seed", "0", "9999999", "0")}}</td>
              <td><button type="button" onclick="startTheTour(1)">?</button></td>
            </tr>
            <tr>
              <td>Preset used to randomize: </td>
              <td>{{displaySelect("paramsFile", presets, "regular")}}</td>
              <td><button type="button" onclick="startTheTour(2)">?</button></td>
            </tr>
          </table>
	  <br/>
	  <h4>The quantity of Minors and Energy</h4>
	  <table class="full">
            <colgroup><col class="half" /><col class="half" /></colgroup>
            <tr>
              <td>Quantity of Missiles:</td>
              <td>{{displayNumber("missileQty", "1", "9", "3")}}</td>
              <td><button type="button" onclick="startTheTour(3)">?</button></td>
            </tr>
            <tr>
              <td>Quantity of Super Missiles:</td>
              <td>{{displayNumber("superQty", "1", "9", "3")}}</td>
            </tr>
            <tr>
              <td>Quantity of Power Bombs:</td>
              <td>{{displayNumber("powerBombQty", "1", "9", "1")}}</td>
            </tr>
            <tr>
              <td>Percentage of minors available:</td>
              <td>{{displayNumber("minorQty", "1", "100", "100")}}</td>
              <td><button type="button" onclick="startTheTour(4)">?</button></td>
            </tr>
            <tr>
              <td>Quantity of Energy/Reserve Tanks available:</td>
              <td>{{displaySelect("energyQty", ["sparse", "medium", "vanilla"], "vanilla")}}</td>
              <td><button type="button" onclick="startTheTour(5)">?</button></td>
            </tr>
	  </table>
	  <br/>
	  <h4>Randomizer parameters</h4>
	  <table class="full">
            <tr>
              <td>{{displayCheckbox("useMaxDiff")}}Maximum difficulty for picking up an item:</td>
              <td>{{displaySelect("maxDifficulty", ['easy', 'medium', 'hard', 'harder', 'hardcore', 'mania'], "hard")}}</td>
              <td><button type="button" onclick="startTheTour(6)">?</button></td>
            </tr>
	    <tr>
	      <td class="half">
                Progression speed:
              </td>
              <td class="half">{{displaySelect("progressionSpeed", ['random', 'slowest', 'slow', 'medium', 'fast', 'fastest'], "medium")}}</td>
              <td><button type="button" onclick="startTheTour(7)">?</button></td>
	    </tr>
	    <tr>
	      <td colspan="2" id="spreadItemsStep">{{displayCheckbox("spreadItems")}}Spread progression items</td>
              <td><button type="button" onclick="startTheTour(8)">?</button></td>
	    </tr>
	    <tr>
	      <td colspan="2" id="fullRandomizationStep">{{displayCheckbox("fullRandomization")}}Full randomization</td>
              <td><button type="button" onclick="startTheTour(9)">?</button></td>
	    </tr>
	    <tr>
	      <td colspan="2" id="suitsRestrictionStep">{{displayCheckbox("suitsRestriction")}}Suits restriction</td>
              <td><button type="button" onclick="startTheTour(10)">?</button></td>
	    </tr>
	    <tr>
	      <td colspan="2" id="speedScrewRestrictionStep">{{displayCheckbox("speedScrewRestriction")}}Early Morph</td>
              <td><button type="button" onclick="startTheTour(11)">?</button></td>
	    </tr>
	  </table>
	</div>
	<div class="column">
	  <h4>Patches</h4>
	  <p>
	    The bug fix <a href="https://itemrando.supermetroid.run/information">patches</a> from Total Item Randomizer are included by default.<br/>
	  </p>
	  <table class="full">
	    <tr>
	      <td class="full" id="layoutPatchesStep">{{displayCheckbox("layoutPatches", True)}} Include layout patches from Total Item Randomizer</td>
	      <td><button type="button" onclick="startTheTour(12)">?</button></td>
	    </tr>
	  </table>
	  </p>
	  <table class="full" id="patchesStep">
{{
for patch in patches:
  response.write("	    <tr>", escape=False)
  response.write("	      <td class=\"full\">", escape=False)
  displayCheckbox(patch[0], patches[2])
  response.write("{}".format(patch[1]))
  response.write("	    </tr>", escape=False)
  pass
}}
	  </table>
          <h4>Super Fun Times (TM)</h4>
          <p>
            Have fun randomly removing major items!<br/>
            <b>Warning:</b> For experienced players only. May cause the Randomizer to abort.
          </p>
	  <table class="full">
            <tr>
              <td class="full" id="funCombatStep">{{displayCheckbox("funCombat")}} Super Fun Combat</td>
              <td><button type="button" onclick="startTheTour(14)">?</button></td>
            </tr>
            <tr>
              <td class="full" id="funMovementStep">{{displayCheckbox("funMovement")}} Super Fun Movement</td>
              <td><button type="button" onclick="startTheTour(15)">?</button></td>
            </tr>
            <tr>
              <td class="full" id="funSuitsStep">{{displayCheckbox("funSuits")}} Suitless</td>
              <td><button type="button" onclick="startTheTour(16)">?</button></td>
            </tr>
          </table>
	</div>
      </div>
       {{=INPUT(_type="submit", _value="Randomize", _id="submitBtn", _class="btn btn-default buttonRandom")}}
    </form>
  </div>
</body>
