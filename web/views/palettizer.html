{{
extend 'layout.html'
}}

<meta name="description" content="Palettizer for the randomized Super Metroid roms"/>
<link rel="shortcut icon" href={{=URL('static','favicon.ico')}} type="image/ico"/>
<script src="{{=URL('static','js/FileSaver.js')}}"></script>
<link rel="stylesheet" type="text/css" href={{=URL('static','css/mystyle_20181203.css')}} media="screen"/>

<link rel="stylesheet" type="text/css" href={{=URL('static','dist/switchery.css')}} media="screen"/>
<script src="{{=URL('static','dist/switchery.js')}}"></script>

<link href={{=URL('static', 'css/bootstrap-tour.min.css')}} rel="stylesheet">
<script src="{{=URL('static','js/bootstrap-tour.min.js')}}"></script>

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<title>Super Metroid VARIA Palettizer</title>

<style>
.popover {
    max-width: 20%;
    /* max-height: 95vh;*/
    /* overflow-y: scroll; */
    position: fixed;
}
.highslide-dimming {
    background: black;
}
#overlay {
    position: fixed; /* Sit on top of the page content */
    display: none; /* Hidden by default */
    width: 100%; /* Full width (cover the whole page) */
    height: 100%; /* Full height (cover the whole page) */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0,0,0,0.5); /* Black background with opacity */
    z-index: 2; /* Specify a stack order in case you're using a different order for other elements */
    cursor: pointer; /* Add a pointer on hover */
}
#loadingGIF {
    position: absolute;
    left: 5%;
    z-index: 3;
    display:none;
}
@media (max-height: 800px) {
    .loadingGIF {
         top: 20%;
    }
}
@media (min-height: 800px) {
    .loadingGIF {
         top: 40%;
    }
}
#psMultiselectDiv {
    display: none;
}
.sixty {
    width: 65%
}
.thirty {
    width: 30%
}
.floatright {
    float: right;
    vertical-align: top;
    margin-top: -0.3em;
}
.floatleft {
    float: left;
    vertical-align: top;
}
</style>

<script type="text/javascript">
function randomize(evt, elemId) {
  var e = document.getElementById(elemId);

  var isActive;
  if(evt.currentTarget.className.search("active") != -1) {
    evt.currentTarget.className = evt.currentTarget.className.replace(" active", "");
    isActive = false;

    defaultValues = {"missileQty": 3, "superQty": 2, "powerBombQty": 1, "minorQty": 100};

    if(e.value.length == 0 && elemId in defaultValues) {
      e.value = defaultValues[elemId];
    }

  } else {
    evt.currentTarget.className += " active";
    isActive = true;
  }

  e.disabled = isActive;
  // grey out the disabled text
  var text = document.getElementById(elemId+"Text");
  if(e.disabled) {
      text.className = "disabledText";
  } else {
      text.className = "";
  }
  // tell switchery
  if(elemId in globalSwitchs){
    var s = globalSwitchs[elemId];
    if(isActive){
      s.disable();
    } else {
      s.enable();
    }
  }

  // special case for prog speed
  if(elemId == "progressionSpeed") {
    if(isActive == true) {
      document.getElementById("progressionSpeed").style.display = "none";
      document.getElementById("psMultiselectDiv").style.display = "block";
      // chosen must be activated when it's visible, else it doesn't work...
      $("#psMultiselect").chosen();
    } else {
      document.getElementById("progressionSpeed").style.display = "block";
      document.getElementById("psMultiselectDiv").style.display = "none";
    }
  }
}

function getComplexity() {
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    if(tablinks[i].className.includes("active")) {
      return tablinks[i].id;
    }
  }
}

function setComplexity() {
{{
  if "complexity" in session.randomizer:
    response.write('  document.getElementById("{}").click();'.format(session.randomizer["complexity"]), escape=False)
  else:
    response.write('  document.getElementById("simple").click();', escape=False)
    pass
}}
}

function changeComplexity(evt, name) {
  if(name == "simple") {
    var show = [];
    var hide = ["seedVisibility", "ammoVisibility", "maxDiffVisibility", "progDiffVisibility", "suitsRestrictionVisibility", "morphPlacementVisibility", "superFunVisibility", "patchesVisibility", "areaPatchVisibility", "hideItemsVisibility", "raceModeVisibility", "colorsRandomizationVisibility"];
    showHide(show, hide);
  }

  else if(name == "medium") {
    var show = ["maxDiffVisibility", "patchesVisibility", "morphPlacementVisibility", "ammoVisibility"
{{
for patch in patches:
  if patch[3] == True:
    response.write(", \"{}Visibitily\"".format(patch[0]), escape=False)
    pass
  pass
}}];
    var hide = ["seedVisibility", "progDiffVisibility", "suitsRestrictionVisibility", "strictMinorsVisibility", "missileQtyVisibility", "superQtyVisibility", "powerBombQtyVisibility", "superFunVisibility", "areaPatchVisibility", "mainPatchesVisibitily", "mainPatchesTextVisibitily", "hideItemsVisibility", "raceModeVisibility", "colorsRandomizationVisibility"
{{
for patch in patches:
  if patch[3] == False:
    response.write(", \"{}Visibitily\"".format(patch[0]), escape=False)
    pass
  pass
}}];
    showHide(show, hide);
  }

  else {
    var show = ["seedVisibility", "ammoVisibility", "maxDiffVisibility", "progDiffVisibility", "suitsRestrictionVisibility", "morphPlacementVisibility", "strictMinorsVisibility", "missileQtyVisibility", "superQtyVisibility", "powerBombQtyVisibility", "superFunVisibility", "patchesVisibility", "areaPatchVisibility", "mainPatchesVisibitily", "mainPatchesTextVisibitily", "hideItemsVisibility", "raceModeVisibility", "colorsRandomizationVisibility"
{{
for patch in patches:
  response.write(", \"{}Visibitily\"".format(patch[0]), escape=False)
  pass
}}];
    var hide = [];
    showHide(show, hide);
  }

  // set current button to active
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
  }

  evt.currentTarget.className += " active";
}

function showHide(show, hide) {
  for(var i=0; i<show.length; i++) {
    var showId = show[i];
    var elem = document.getElementById(showId);
    elem.classList.remove("hidden");
  }
  for(var i=0; i<hide.length; i++) {
    var hideId = hide[i];
    var elem = document.getElementById(hideId);
    elem.classList.add("hidden");
  }
}

var globalSwitchs = {};

function AjaxPresetCallCompleted(data) {
    console.log("AjaxPresetCallCompleted");

    var dataDict = {paramsFileTarget : data, "complexity": getComplexity()};
    var elems = ["seed", "itemsounds", "spinjumprestart", "elevators_doors_speed", "skip_ceres", "skip_intro", "animals", "layoutPatches", "noGravHeat", "areaLayout", "variaTweaks", "areaRandomization", "No_Music", "preset",
"bossRandomization", "colorsRandomization", "suitsPalettes", "beamsPalettes", "tilesPalettes", "enemiesPalettes", "bossesPalettes"];
    var randomElems = ["missileQty", "superQty", "powerBombQty", "minorQty", "energyQty", "maxDifficulty", "majorsSplit", "suitsRestriction", "morphPlacement", "funCombat", "funMovement", "funSuits", "progressionDifficulty", "hideItems", "strictMinors"];

    for(var i=0; i<elems.length; i++) {
       dataDict[elems[i]] = document.getElementById(elems[i]).value;
    }
    for(var i=0; i<randomElems.length; i++) {
       // check if random dice is checked
       if(document.getElementById(randomElems[i]+"Random").className.search("active") != -1) {
         dataDict[randomElems[i]] = "random";
       } else {
         dataDict[randomElems[i]] = document.getElementById(randomElems[i]).value;
       }
    }

    dataDict["progressionSpeed"] = getProgSpeed();

    // add race mode
    var raceMode = document.getElementById("raceMode");
    if(raceMode.checked) {
      var maxHourRace = document.getElementById("maxHourRace");
      dataDict["raceMode"] = maxHourRace.value;
    }

    // add colors slider
    dataDict["minDegree"] = $("#degree_slider_range").slider("values", 0);
    dataDict["maxDegree"] = $("#degree_slider_range").slider("values", 1);

    // call web service with parameters
    var request = $.ajax({
      url: "{{=URL(f='randomizerWebService')}}",
      method: "POST",
      data: dataDict,
      dataType: "json",
      crossDomain: true
    });

    request.done(AjaxRandomizerCallCompleted);
    request.fail(ajaxFailJSON);
}

function ajaxFail(jqXHR, textStatus) {
  document.getElementById("flash").innerHTML = jqXHR.responseText;
  $('#flash').show();
  $('#overlay').hide();
  $('#loadingGIF').hide();
}

function ajaxFailJSON(jqXHR, textStatus) {
  // cross domain calls currently return 'undefined' information... (cf. https://www.html5rocks.com/en/tutorials/cors/)
  if(jqXHR.responseJSON == null) {
    document.getElementById("flash").innerHTML = "Something wrong happened or the VARIA randomizer aborted: please try again. If this happens again after retrying, raise or disable max difficulty setting, and/or disable Super Fun Times (TM) setting. If Area Randomization was selected, try to enable Full Randomization as well.";
  } else {
    document.getElementById("flash").innerHTML = jqXHR.responseJSON;
  }
  $('#flash').show();
  $('#overlay').hide();
  $('#loadingGIF').hide();
}

function AjaxRandomizerCallCompleted(data) {
    console.log("AjaxRandomizerCallCompleted");

    // with items/Locations patch the local rom in memory
    var filesInput = document.getElementById("uploadFile");
    var file = filesInput.files[0];

    var reader = new FileReader();
    reader.readAsArrayBuffer(file);

    reader.onload = function(e) {
        var bytes = new Uint8Array(e.target.result);

        for(var key in data) {
            if(key === "fileName" || key === "errorMsg") { continue; }
            bytes[key] = data[key];
        }

        var blob = new Blob([bytes], {type: "octet/stream"});

        var outFileName = data['fileName'];
        saveAs(blob, outFileName);
    }

    // info message to display ?
    if("errorMsg" in data && data["errorMsg"].length > 0) {
        document.getElementById("flash").innerHTML = data["errorMsg"];
        $('#flash').show();
        displayFlash = true;
    } else {
        displayFlash = false;
    }

    // set backup button text to Randomize
    document.getElementById("submitBtn").data = "Randomize";
    console.log("button text set back to randomize");

    var dataDict = {"complexity": getComplexity()};
    var elems = ["itemsounds", "spinjumprestart", "elevators_doors_speed", "skip_ceres", "skip_intro", "animals", "layoutPatches", "noGravHeat", "areaLayout", "variaTweaks", "areaRandomization", "bossRandomization", "No_Music", "preset", "randoPreset", "colorsRandomization", "suitsPalettes", "beamsPalettes", "tilesPalettes", "enemiesPalettes", "bossesPalettes"];
    var randomElems = ["missileQty", "superQty", "powerBombQty", "minorQty", "energyQty", "maxDifficulty", "majorsSplit", "suitsRestriction", "morphPlacement", "funCombat", "funMovement", "funSuits", "progressionDifficulty", "hideItems", "strictMinors"];

    for(var i=0; i<elems.length; i++) {
       dataDict[elems[i]] = document.getElementById(elems[i]).value;
    }
    for(var i=0; i<randomElems.length; i++) {
       // check if random dice is checked
       if(document.getElementById(randomElems[i]+"Random").className.search("active") != -1) {
         dataDict[randomElems[i]] = "random";
       } else {
         dataDict[randomElems[i]] = document.getElementById(randomElems[i]).value;
       }
    }

    dataDict["progressionSpeed"] = getProgSpeed();

    dataDict["minDegree"] = $("#degree_slider_range").slider("values", 0);
    dataDict["maxDegree"] = $("#degree_slider_range").slider("values", 1);

    // call webservice to update the session
    var request = $.ajax({
      url: "{{=URL(f='sessionWebService')}}",
      method: "POST",
      data: dataDict,
      dataType: "html"
    });

    request.fail(ajaxFail);

    // remove "working" message
    if(displayFlash == false){
        $('#flash').hide();
    }
    $('#overlay').hide();
    $('#loadingGIF').hide();
}

function doSubmit() {
  if(window.File && window.FileList && window.FileReader) {

    var filesInput = document.getElementById("uploadFile");
    var file = filesInput.files[0]
    if (file === undefined) {
      alert("Please select a Super Metroid Vanilla ROM first")
      btn = document.getElementById("submitBtn");
      btn.data = "Randomize";
      btn.disabled = false;

      setTimeout(function(){ 
          btn = document.getElementById("submitBtn");
          btn.data = "Randomize";
          btn.disabled = false;
      }, 20000);

      return false;
    }

    var dataDict = {"preset": document.getElementById("preset").value};

    console.log("before preset web service call"+dataDict["preset"]);

    // call preset web service with parameters
    var request = $.ajax({
      url: "{{=URL(f='presetWebService')}}",
      method: "POST",
      data: dataDict,
      dataType: "html"
    });

    request.done(AjaxPresetCallCompleted);
    request.fail(ajaxFail);

    // while WS is working, display "working" message
    $('#overlay').show();
    $('#loadingGIF').show();
  }

  return false;
}

window.onload = function(){
    //Check File API support
    if(window.File && window.FileList && window.FileReader) {
        var filesInput = document.getElementById("uploadFile");
        filesInput.addEventListener("change", function(event){
            var files = event.target.files; //It returns a FileList object
            var file = files[0];

            var reader = new FileReader();
            reader.onload = function(e) {
		// check sfc or smc extention
                var re = /(?:\.([^.]+))?$/;
		var ext = re.exec(file.name)[1];
                console.log("ext: "+ext)
                if( ! (ext === "sfc" || ext === "smc") ) {
                    document.getElementById("uploadFile").value = "";
                    alert("wrong extension: "+ext);
                    return false;
                }

                var fileSize = file.size;
		if( fileSize > 4*1024*1024 ) {
                    document.getElementById("uploadFile").value = "";
                    alert("wrong rom file size: "+fileSize.toString());
                    return false;
                }
            }

            reader.readAsArrayBuffer(file)

        }, false);
    } else {
        alert("This website requires the HTML5 File API, please upgrade your browser to a newer version.");
    }


    var inputs = document.getElementsByTagName("input");
    for(var i = 0; i < inputs.length; i++) {
        if(inputs[i].type == "checkbox") {
            // progression speed checkboxes don't need switchery, so they don't have a name property
            if(inputs[i].name != "") {
              var s = new Switchery(document.getElementById(inputs[i].name), { size: 'small', color: '#ddd' });
              globalSwitchs[inputs[i].name] = s;
            }
        }
    }

    //setColorsCheckboxes();
    setComplexity();

    initSlider();
}

function initSlider() {
  $("#degree_slider_range").slider({
    range: true,
    min: -180,
    max: 180,
    values: [-180, 180],
    slide: function(event, ui) {
      $("#colorsText").text("Degree ["+(ui.values[0])+" , "+(ui.values[1])+"]");
    }
  });
  // set current values
  $("#degree_slider_range").slider("values", 0, {{=session.randomizer["minDegree"]}});
  $("#degree_slider_range").slider("values", 1, {{=session.randomizer["maxDegree"]}});

  // set text
  $("#colorsText").text("Degree ["+($("#degree_slider_range").slider("values", 0))+" , "+($("#degree_slider_range").slider("values", 1))+"]");
}

function switchCheckbox(id, elems=[]) {
  var check = document.getElementById(id);
  if(check.checked){
    check.value = "on";
  } else {
    check.value = "off";
  }

  for(var i=0; i<elems.length; i++){
    elemId = elems[i];
    var e = document.getElementById(elemId);
    e.disabled = check.checked;
    // grey out the disabled text
    var text = document.getElementById(elems[i]+"Text");
    if(e.disabled) {
        text.className = "disabledText";
    } else {
        text.className = "";
    }
    // tell switchery
    if(elemId in globalSwitchs){
      var s = globalSwitchs[elemId];
      if(check.checked){
        s.disable();
      } else {
        s.enable();
      }
    }
  }
}

function startTheTour(step=-1) {
  // the tour tutorial
  var tour = new Tour({
    storage: false,
    steps: [
    {
      element: "#uploadFile",
      title: "Vanilla Super Metroid ROM",
      content: "Use an American/Japan unheadered ROM of Super Metroid.<br/>The randomized ROM is generated locally."
    },
    {
      element: "#colorsRandomizationStep",
      title: "Color randomization",
      content: "Randomize the colors of various graphical elements:<br/><img src=\"/solver/static/images/palettesRando.png\" alt=\"colors rando\" title=\"colors rando\" class=\"full\"/>Use the slider to restrict the possible range of the colors shifting, with zero meaning no shifting.",
      placement: "auto left"
    },
    {
      element: "#patchesStep",
      title: "Default Patches",
      content: "Patches also included by default:<ul><li>Allows the aim buttons to be assigned to any button (by Kejardon)</li><li>Max Ammo Display (by Personitis)</li><li>Play music with MSU1 chip on SD2SNES (by DarkShock)</li></ul>",
      placement: "auto left"
    },
    {
      element: "#layoutPatchesStep",
      title: "Layout patches",
      content: "Include the anti-softlock layout patches from Total Item Randomizer. Disable at your own softlocking risk!\
<ul><li>Disable respawning blocks at Dachora Pit</li>\
<li>Make it possible to escape from below early Super bridge without Bombs</li>\
<li>Replace bomb blocks with shot blocks before Hi-Jump</li>\
<li>Replace bomb blocks with shot blocks at Moat</li>\
<li>Raise platform in first heated Norfair room to not require Hi-Jump</li>\
<li>Raise platforms in Red Tower bottom to always be able to get back up</li>\
<li>Replace bomb blocks with shot blocks before Spazer</li></ul>",
      placement: "auto left"
    },
    {
      element: "#noGravHeatStep",
      title: "Optional patches",
      content: "Patch from Total Item Randomizer to remove the Gravity Suit environmental protection (heat, spikes, electricity...), it balances more the two suits abilities. Disable it to have a more vanilla feeling.",
      placement: "auto left"
    },
    {
      element: "#variaTweaksStep",
      title: "Optional patches",
      content: "Include minor tweaks for the game to behave 'as it should' in a randomizer context :\
<ul><li>Bomb Torizo fight is triggered when picking up the item he's holding, not by having Bomb</li>\
<li>Access item at Wrecked Ship Etank location without killing Phantoon (via Forgotten Highway)</li>\
<li>Activate Lower Norfair Chozo (left of entrance) without Space Jump</li></ul>",
      placement: "auto left"
    } ]});

  // Initialize the tour
  tour.init();

  // Start the tour
  if(step != -1) {
    tour.goTo(step);
  }
  tour.start();
}
</script>
{{
def displayCheckbox(id, defaultTrue=False):
  if (id in session.randomizer and session.randomizer[id] == 'on') or (id not in session.randomizer and defaultTrue == True):
}}
    {{=INPUT(_id=id, _name=id, _type="checkbox", _checked="checked", _value="on", _class="js-switch", _onchange="switchCheckbox('{}')".format(id))}}
{{
  else:
}}
    {{=INPUT(_id=id, _name=id, _type="checkbox", _value="off", _class="js-switch", _onchange="switchCheckbox('{}')".format(id))}}
    {{pass}}
  {{pass}}

{{
def displaySelect(id, values, default):
  if id in session.randomizer:
    if id == "progressionSpeed":
      if type(session.randomizer["progressionSpeed"]) == list:
        if len(session.randomizer["progressionSpeed"]) == 1:
          value = session.randomizer[id][0]
        else:
          value = default
          pass
      else:
        value = session.randomizer[id]
        pass
    else:
      value = session.randomizer[id]
      pass
  else:
    value = default
    pass
}}
  {{
   =SELECT(*values,
           **dict(_id=id, _name=id, value=value, _class="full"))
  }}
{{pass}}
{{
def displayNumber(id, min, max, default, step="1"):
  if id in session.randomizer:
    value = session.randomizer[id]
  else:
    value = default
    pass

  response.write("<input name=\"{}\" id=\"{}\" type=\"number\" value=\"{}\" min=\"{}\" max=\"{}\" step=\"{}\" class=\"full\" required>".format(id, id, value, min, max, step), escape=False)
  pass
}}
<body>
  <div id="overlay"></div>
  <div id="loadingGIF"><img src={{=URL('static/images','ajax-loader.gif')}}/></div>

  <div class="fixed">
    <div class="menu">
    <table class="full menuTable">
      <tr>
	<td>{{=A("Home", _href=URL(f="home"), _class="menu")}}</td>
	<td>{{=A("Presets", _href=URL(f="presets"), _class="menu")}}</td>
	<td>{{=A("Randomizer", _href=URL(f="randomizer"), _class="menu")}}</td>
	<td>{{=A("Solver", _href=URL(f="solver"), _class="menu")}}</td>
	<td>{{=A("Trackers", _href=URL(f="tracker"), _class="menu")}}</td>
	<td>{{=A("Plandomizer", _href=URL(f="plando"), _class="menu")}}</td>
	<td class="menu_selected">{{=A("Palletizer", _href=URL(f="palette"), _class="menu")}}</td>
	<td>{{=A("Information & Contact", _href=URL(f="infos"), _class="menu")}}</td>
      </tr>
    </table>
    </div>
  </div>

  <div class="main">
    <div id="complexityTabs" class="center">
      <div class="tab">
        <button class="tablinks" id="simple" onclick="changeComplexity(event, 'simple');">Simple</button>
        <button class="tablinks" id="medium" onclick="changeComplexity(event, 'medium');">Medium</button>
        <button class="tablinks" id="advanced" onclick="changeComplexity(event, 'advanced');">Advanced</button>
      </div>
    </div>
    <form id="mainform" name="mainform" onsubmit="doSubmit(); return false;">
      <div id="tabRando" class="tabcontent">
        <div class="row">
	  <div class="column">
	    <p>The Very Adaptive Randomizer of Items and Area (VARIA) randomizer will generate a Super Metroid ROM finishable using the known techniques of the chosen preset.</p>
            <table class="full">
              <colgroup><col class="half" /><col class="half" /></colgroup>
              <tr>
                <td>Super Metroid ROM:</td>
                <td>{{=INPUT(_type="file", _name="uploadFile", _id="uploadFile", _class="full")}}</td>
                <td><button type="button" onclick="startTheTour(0)">?</button></td>
              </tr>
            </table>
            <h4>Colors Randomization</h4>
            <p>
	      Randomize the colors of Samus, beams, levels, enemies and bosses.
            </p>
	    <table class="full">
	      <tr>
	        <td class="half" id="colorsRandomizationStep">{{displayCheckbox("colorsRandomization")}}Colors Randomization</td>
		<td class="half"><div id="degree_slider_range" class="sixty floatleft"></div><span id="colorsText" class="thirty floatright"></span></td>
                <td><button type="button" onclick="startTheTour(19)">?</button></td>
	      </tr>
            </table>
	    <div id="colorsRandomizationVisibility">
	      <p>
		Select the elements to colors randomize.
	      </p>
	      <table class="full">
		<tr>
	          <td class="third">{{displayCheckbox("suitsPalettes")}}Samus colors</td>
	          <td class="third">{{displayCheckbox("beamsPalettes")}}Beams colors</td>
	          <td class="third">{{displayCheckbox("tilesPalettes")}}Levels colors</td>
		</tr>
		<tr>
	          <td class="third">{{displayCheckbox("enemiesPalettes")}}Enemies colors</td>
	          <td class="third">{{displayCheckbox("bossesPalettes")}}Bosses colors</td>
		  <td class="third"></td>
		</tr>
	      </table>
	    </div>
	    <div id="patchesVisibility">
	      <h4 id="patchesStep">Patches<span class="right"><button type="button" onclick="startTheTour(23)">?</button></span></h4>
	      <p id="mainPatchesTextVisibitily">
	        The bug fix <a href="https://itemrando.supermetroid.run/information">patches</a> from Total Item Randomizer are included by default.
	      </p>
	      <table class="full" id="mainPatchesVisibitily">
	        <tr>
		  <td class="full" id="layoutPatchesStep">{{displayCheckbox("layoutPatches", True)}} Include layout patches from Total Item Randomizer</td>
		  <td><button type="button" onclick="startTheTour(24)">?</button></td>
	        </tr>
	        <tr>
		  <td class="full" id="noGravHeatStep">{{displayCheckbox("noGravHeat", True)}} Remove Gravity Suit heat protection (by Total)</td><td><button type="button" onclick="startTheTour(25)">?</button></td>
	        </tr>
	        <tr>
		  <td class="full" id="variaTweaksStep">{{displayCheckbox("variaTweaks", True)}} VARIA tweaks (by Flo)</td><td><button type="button" onclick="startTheTour(26)">?</button></td>
	        </tr>
	      </table>
	      <table class="full" id="patchesStep">
{{
for patch in patches:
  response.write("	    <tr>", escape=False)
  response.write("	      <td class=\"full\" id=\"{}Visibitily\">".format(patch[0]), escape=False)
  displayCheckbox(patch[0], patches[2])
  response.write("{}".format(patch[1]))
  response.write("	    </tr>", escape=False)
  pass
}}
	      </table>
	    </div>
	  </div>
        </div>
        {{=INPUT(_type="submit", _value="customize", _id="submitBtn", _class="btn btn-default buttonRandom")}}
    </form>
  </div>
</body>
