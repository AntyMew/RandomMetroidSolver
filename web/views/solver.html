{{extend 'layout.html'}}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="shortcut icon" href={{=URL('static','favicon.ico')}} type="image/ico"/>
<title>Super Metroid Item Randomizer Solver</title>

<style>
.checked {
    color: orange;
}
  a:link {color: SteelBlue;}
  a:visited {color: gray;}
  .web2py-menu-active {border: 2px solid gray;
                       border-radius: 12px;}
label {
    font-weight: normal !important;
}
</style>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
function toggleSelect(elem)
{
  var boolElem = elem + "_bool"
  var boolElemHidden = boolElem + "_hidden"
  var diffElem = elem + "_diff"
  var isChecked = document.getElementById(boolElem).checked;
  document.getElementById(diffElem).disabled = !isChecked;
  document.getElementById(boolElemHidden).checked = isChecked;
}
function changeHiddenSelect(diffElem)
{
  var diffElemHidden = diffElem + "_hidden"
  document.getElementById(diffElemHidden).value = document.getElementById(diffElem).value
  document.getElementById(diffElemHidden).selectedIndex = document.getElementById(diffElem).selectedIndex
}
function showPath()
{
  if(document.getElementById('displayPath').checked) {
    document.getElementById('path_div').style.display = "block";
  } else {
    document.getElementById('path_div').style.display = "none";
  }
}

{{
if resultText is not None:
}}

      google.charts.load('current', {'packages':['timeline']});
      google.charts.setOnLoadCallback(drawChart);


      function drawChart() {
        var container = document.getElementById('timeline');
        var chart = new google.visualization.Timeline(container);
        var dataTable = new google.visualization.DataTable();

        dataTable.addColumn({ type: 'string', id: 'Role' });
        dataTable.addColumn({ type: 'string', id: 'Difficulty' });
        dataTable.addColumn({ type: 'date', id: 'Start' });
        dataTable.addColumn({ type: 'date', id: 'End' });
        dataTable.addRows([
{{
if diffPercent <= 20:
  response.write("[ 'Difficulty', 'easy', new Date(1900, 0, 0), new Date(19{}, 0, 0) ]".format(diffPercent), escape=False)
else:
  response.write("[ 'Difficulty', 'easy', new Date(1900, 0, 0), new Date(1920, 0, 0) ],", escape=False)
  pass
if diffPercent > 20 and diffPercent <= 40:
  response.write("[ 'Difficulty', 'medium', new Date(1920, 0, 0), new Date(19{}, 0, 0) ]".format(diffPercent), escape=False)
elif diffPercent > 40:
  response.write("[ 'Difficulty', 'medium', new Date(1920, 0, 0), new Date(1940, 0, 0) ],", escape=False)
  pass
if diffPercent > 40 and diffPercent <= 60:
  response.write("[ 'Difficulty', 'hard', new Date(1940, 0, 0), new Date(19{}, 0, 0) ]".format(diffPercent), escape=False)
elif diffPercent > 60:
  response.write("[ 'Difficulty', 'hard', new Date(1940, 0, 0), new Date(1960, 0, 0) ],", escape=False)
  pass
if diffPercent > 60 and diffPercent <= 80:
  response.write("[ 'Difficulty', 'very hard', new Date(1960, 0, 0), new Date(19{}, 0, 0) ]".format(diffPercent), escape=False)
elif diffPercent > 80:
  response.write("[ 'Difficulty', 'very hard', new Date(1960, 0, 0), new Date(1980, 0, 0) ],", escape=False)
  pass
if diffPercent > 80 and diffPercent <= 100:
  if diffPercent == 100:
    diffPercent = 99
    pass
  response.write("[ 'Difficulty', 'hardcore', new Date(1980, 0, 0), new Date(19{}, 0, 0) ]".format(diffPercent), escape=False)
  pass
}}
          ]);

        var options = {
          hAxis: {
            minValue: new Date(1900, 0, 0),
            maxValue: new Date(2000, 0, 0)
          },
          timeline: { groupByRowLabel: true},
          tooltip: { trigger: 'none' },
          colors: ['#6daa53', '#f1be0b', '#e69235', '#d13434', '#000000'],
          avoidOverlappingGridLines: false,
        };

function allReady() {
    var e = document.getElementById('timeline');
    // svg elements don't have inner/outerHTML properties, so use the parents
    alert(e.getElementsByTagName('svg')[0].parentNode.innerHTML);
}

    google.visualization.events.addListener(chart, 'ready', function () {
      // remove haxis label
      var labels = container.getElementsByTagName('text');

      for (i = 0; i < labels.length; i++) {
        // console.log(labels[i].textContent)
        if (labels[i].textContent.substring(0,2) == '19') {
          //console.log("found")
          labels[i].parentNode.removeChild(labels[i]);
          i--;
        }
      }

    });
//google.visualization.events.addListener(chart, 'ready', allReady);
        chart.draw(dataTable, options);
}
{{
pass
}}
</script>

<body>
{{
def displayKnow(know):
  response.write("<tr>\n", escape=False)

  checked="value=\"off\""
  if knows[know][0] is True:
    checked="checked=\"checked\" value=\"on\""
    pass
  response.write("  <td><input id=\"{}_bool\" name=\"{}_bool\" type=\"checkbox\" {} onClick=\"toggleSelect('{}')\" form=\"mainform\"></td>\n".format(know, know, checked, know), escape=False)

  if desc[know]['href'] is not None:
    response.write("  <td><a href=\"{}\">&nbsp&nbsp{}&nbsp&nbsp</a></td>\n".format(desc[know]['href'], desc[know]['display']), escape=False)
  else:
    response.write("  <td>&nbsp&nbsp{}&nbsp&nbsp</td>\n".format(desc[know]['display']), escape=False)
    pass

  disabled=""
  if knows[know][0] is False:
    disabled="disabled"
    pass

  response.write("  <td><select id=\"{}_diff\" name=\"{}_diff\" {} form=\"mainform\" onchange=\"changeHiddenSelect('{}_diff')\">\n".format(know, know, disabled, know), escape=False)
  knowDiff=knows[know][1]
  knowDiff=knowDiff if knowDiff != 0 else mania
  for difficulty in [easy, medium, hard, harder, hardcore, mania]:
    selected=""
    if knowDiff == difficulty:
      selected="selected=\"selected\""
      pass

    response.write("    <option value=\"{}\" {}>{}</option>\n".format(difficulties[difficulty], selected, difficulties[difficulty]), escape=False)
    pass

  response.write("  <td>&nbsp&nbsp{}</td>".format(desc[know]['title']), escape=False)

  response.write("  <td><input id=\"{}_bool_hidden\" name=\"{}_bool_hidden\" type=\"checkbox\" {} form=\"saveform\" style='display:none'></td>\n".format(know, know, checked, know), escape=False)

  response.write("  <td><select id=\"{}_diff_hidden\" name=\"{}_diff_hidden\" form=\"saveform\" style='display:none'>\n".format(know, know), escape=False)
  knowDiff=knows[know][1]
  knowDiff=knowDiff if knowDiff != 0 else mania
  for difficulty in [easy, medium, hard, harder, hardcore, mania]:
    selected=""
    if knowDiff == difficulty:
      selected="selected=\"selected\""
      pass

    response.write("    <option value=\"{}\" {}>{}</option>\n".format(difficulties[difficulty], selected, difficulties[difficulty]), escape=False)
    pass


  response.write("</tr>\n", escape=False)
  pass

def displayCategory(category):
  response.write("<h2>{}</h2>\n".format(category['title']), escape=False)
  response.write("<table>\n", escape=False)
  for know in category['knows']:
    displayKnow(know)
    pass
  response.write("</table>\n", escape=False)
pass
}}

Enter your tournament rom seed, ajust the presets depending on the techniques you know then press 'Compute Difficulty'.

{{=mainForm}}

<hr>

{{
if resultText is not None:
  =resultText

  difficulties = {
      easy : 'easy',
      medium : 'medium',
      hard : 'hard',
      harder : 'very hard',
      hardcore : 'hardcore',
      mania : 'mania',
      mania*2: 'god'
  }

  response.write("</table>", escape=False)

  response.write("<br/>", escape=False)
  pass
}}

{{
if resultText is not None and difficulty != -1:
}}
<div id="timeline" style="height: 95px; width: 50%;"></div>

{{
pass
}}

{{
if resultText is not None:
  response.write("<input id=\"displayPath\" name=\"displayPath\" type=\"checkbox\" onClick=\"showPath()\">\n", escape=False)
  response.write("Display the generated path (spoilers)")

  response.write("<div id=\"path_div\" style=\"display:none;\">\n", escape=False)
  response.write("<hr>\n", escape=False)
  =pathTable
  response.write("</div>\n", escape=False)
  response.write("<hr>\n", escape=False)
  pass
}}

Load a previously saved presets.

{{=loadForm}}

<hr>

The maximum difficulty for picking up an item in the current area before moving to another area.
<br/>

Difficulty target:
{{
=SELECT('easy', 'medium', 'hard', 'very hard', 'hardcore', 'mania',
       _id="difficulty_target",
       _name="difficulty_target",
       _form="mainform",
       _onchange="changeHiddenSelect('difficulty_target')",
       requires=IS_IN_SET(['easy', 'medium', 'hard', 'very hard', 'hardcore', 'mania']),
       value=difficulties[conf["target"]])
}}
{{
=SELECT('easy', 'medium', 'hard', 'very hard', 'hardcore', 'mania',
       _id="difficulty_target_hidden",
       _name="difficulty_target_hidden",
       _form="saveform",
       _style='display:none',
       requires=IS_IN_SET(['easy', 'medium', 'hard', 'very hard', 'hardcore', 'mania']),
       value=difficulties[conf["target"]])
}}
<br/><br/>
The strategy for picking up major and minor items.
<br/>
<ul>
<li>All:</li>
<ul><li>Will grab all the major and minor items.</li></ul>

<li>Minimal:</li>
<ul>
<li>Majors:

Will get Morph, Bomb and/or Power bombs, 3 ETanks, Varia,<br/>
Gravity, Speed Booster or Ice Beam, and anything else along the way.
</li>
<li>Minors:

Will pick up 10 Missiles packs, 5 Super packs and 2 Power Bomb<br/>
packs. If Charge Beam is not picked up along the way or not<br/>
accessible, enough minors to beat Mother Brain will be picked up.
</li>
</ul>
</ul>
<br/>
Pickup strategy:
{{
=SELECT('all', 'minimal',
        _id="pickup_strategy",
        _name="pickup_strategy",
        _form="mainform",
        _onchange="changeHiddenSelect('pickup_strategy')",
        requires=IS_IN_SET(['all', 'minimal']),
        value=conf["pickup"])
}}
{{
=SELECT('all', 'minimal',
        _id="pickup_strategy_hidden",
        _name="pickup_strategy_hidden",
        _form="saveform",
        _style='display:none',
        requires=IS_IN_SET(['all', 'minimal']),
        value=conf["pickup"])
}}

<hr>

For each technique you can choose if you know it and your perceived difficulty.</br>
Clicking on most of the techniques will send you to an explanation or a tutorial.

{{
for category in categories:
  displayCategory(category)
  pass

pass
}}

<hr>

Save or update the presets. A password is required to later modify the presets.

{{=saveForm}}

</body>
